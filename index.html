<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مختبر الكيمياء التفاعلي</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2c5e1a;
      --secondary-color: #4a8c2a;
      --accent-color: #ffd700;
      --light-bg: #f8f9fa;
      --white: #ffffff;
      --dark-text: #333333;
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background-color: var(--light-bg);
      padding: 0;
      margin: 0;
      color: var(--dark-text);
      line-height: 1.6;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: var(--white);
      padding: 1rem;
      text-align: center;
      border-bottom: 4px solid var(--accent-color);
      box-shadow: var(--box-shadow);
    }

    h1 {
      margin: 0;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 0.5rem 0;
    }

    .container {
      width: 95%;
      margin: 1rem auto;
      padding: 0 0.5rem;
    }

    .button-group {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }

    button {
      background-color: var(--primary-color);
      color: var(--white);
      padding: 0.6rem 1rem;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 700;
      font-size: 0.9rem;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      white-space: nowrap;
    }

    button:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .chemicals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 0.8rem;
      margin: 1rem 0;
    }

    .chemical {
      background-color: var(--white);
      padding: 0.8rem 0.5rem;
      border-radius: var(--border-radius);
      cursor: grab;
      font-weight: 700;
      text-align: center;
      transition: var(--transition);
      box-shadow: var(--box-shadow);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
      font-size: 0.9rem;
    }

    .chemical:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-color: var(--accent-color);
    }

    .chemical::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--accent-color);
    }

    .lab, .history {
      background-color: var(--white);
      padding: 1.2rem;
      border-radius: var(--border-radius);
      margin-top: 1rem;
      box-shadow: var(--box-shadow);
    }

    .section-title {
      color: var(--primary-color);
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 60px;
      height: 2px;
      background-color: var(--accent-color);
    }

    #test-tube {
      margin: 1.5rem auto;
      padding: 1.5rem;
      border: 2px dashed var(--primary-color);
      width: 90%;
      max-width: 350px;
      min-height: 100px;
      background-color: rgba(234, 250, 241, 0.5);
      border-radius: var(--border-radius);
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      transition: background-color 0.6s ease, border 0.3s ease;

    }

    #test-tube:hover {
      background-color: rgba(234, 250, 241, 0.8);
    }

    #test-tube::before {
      content: '🧪';
      font-size: 1.8rem;
      margin-bottom: 0.8rem;
    }

    #tube-content {
      margin: 0;
      font-size: 1rem;
      color: var(--dark-text);
    }

    #reaction-result {
      margin: 1.5rem auto;
      padding: 1rem;
      background-color: var(--light-bg);
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 500;
      max-width: 90%;
      border-right: 3px solid var(--accent-color);
    }

    #score {
      font-size: 1.1rem;
      margin: 1rem 0;
      color: var(--primary-color);
      font-weight: 700;
      background-color: rgba(255, 215, 0, 0.2);
      padding: 0.8rem;
      border-radius: var(--border-radius);
      display: inline-block;
    }

    .hidden { 
      display: none; 
    }

    /* تأثيرات التفاعل */
    .smoke {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background: radial-gradient(closest-side, rgba(255,255,255,0.8), transparent);
      border-radius: 50%;
      animation: smokeRise 2s ease-out forwards;
      pointer-events: none;
      z-index: 10;
    }

    @keyframes smokeRise {
      0% { transform: translateX(-50%) translateY(0) scale(0.8); opacity: 0.8; }
      100% { transform: translateX(-50%) translateY(-150px) scale(1.3); opacity: 0; }
    }

    /* قائمة التاريخ */
    #history-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    #history-list li {
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      background-color: var(--light-bg);
      border-radius: var(--border-radius);
      border-right: 3px solid var(--accent-color);
      transition: var(--transition);
      font-size: 0.9rem;
    }

    #history-list li:hover {
      transform: translateX(-3px);
      background-color: rgba(74, 140, 42, 0.1);
    }

    /* تأثيرات السحب والإفلات */
    .drag-over {
      background-color: rgba(74, 140, 42, 0.2) !important;
      border-color: var(--secondary-color) !important;
    }

    /* تصميم متجاوب للشاشات الصغيرة جدًا */
    @media (max-width: 480px) {
      .chemicals-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 0.5rem;
      }
      
      h1 {
        font-size: 1.3rem;
      }
      
      .section-title {
        font-size: 1.1rem;
      }
      
      button {
        padding: 0.5rem 0.8rem;
        font-size: 0.8rem;
      }
      
      #test-tube {
        padding: 1rem;
        min-height: 80px;
      }
      
      #reaction-result {
        padding: 0.8rem;
        font-size: 0.9rem;
      }
    }

    /* تعديلات للوضع الأفقي على الهواتف */
    @media (max-height: 500px) and (orientation: landscape) {
      header {
        padding: 0.5rem;
      }
      
      h1 {
        font-size: 1.2rem;
      }
      
      .container {
        margin: 0.5rem auto;
      }
      
      .chemicals-grid {
        grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
        gap: 0.5rem;
        margin: 0.5rem 0;
      }
      
      .chemical {
        padding: 0.5rem;
        font-size: 0.8rem;
      }
      
      #test-tube {
        margin: 0.8rem auto;
        padding: 0.8rem;
        min-height: 60px;
      }
    }

    
  </style>
</head>
<body>

  <header>
    <div class="container">
      <h1><span>🔬</span> مختبر الكيمياء التفاعلي</h1>
      <div class="button-group">
        <button onclick="showLab()"><span>🏠</span> التجارب</button>
        <button onclick="showHistory()"><span>📜</span> سجل التجارب</button>
        <button onclick="resetData()"><span>♻️</span> إعادة ضبط</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="lab" id="lab-section">
      <h2 class="section-title">اختر المواد الكيميائية</h2>
      
      <div class="chemicals-grid">
        <!-- المواد الأصلية -->
        <div class="chemical" draggable="true" data-name="HCl">حمض HCl</div>
        <div class="chemical" draggable="true" data-name="NaOH">قاعدة NaOH</div>
        <div class="chemical" draggable="true" data-name="Na">صوديوم</div>
        <div class="chemical" draggable="true" data-name="H2O">ماء</div>
        <!-- مواد جديدة -->
        <div class="chemical" draggable="true" data-name="H2SO4">حمض H₂SO₄</div>
        <div class="chemical" draggable="true" data-name="CuSO4">كبريتات CuSO₄</div>
        <div class="chemical" draggable="true" data-name="AgNO3">نترات AgNO₃</div>
        <div class="chemical" draggable="true" data-name="NH3">الأمونيا NH₃</div>
        <div class="chemical" draggable="true" data-name="BaCl2">كلوريد BaCl₂</div>
        <div class="chemical" draggable="true" data-name="NaCl">ملح NaCl</div>
        <div class="chemical" draggable="true" data-name="Fe">حديد Fe</div>
        <div class="chemical" draggable="true" data-name="HCl">حمض HCl</div>
        <div class="chemical" draggable="true" data-name="Mg">مغنيسيوم Mg</div>
<div class="chemical" draggable="true" data-name="O2">أكسجين O₂</div>
<div class="chemical" draggable="true" data-name="CaCO3">كربونات الكالسيوم CaCO₃</div>
<div class="chemical" draggable="true" data-name="H2SO4">حمض الكبريتيك H₂SO₄</div>
<div class="chemical" draggable="true" data-name="Zn">زنك Zn</div>
<div class="chemical" draggable="true" data-name="CH4">ميثان CH₄</div>
<div class="chemical" draggable="true" data-name="O2">أوكسجين O₂</div>
<div class="chemical" draggable="true" data-name="H2O2">فوق أكسيد الهيدروجين H₂O₂</div>
<div class="chemical" draggable="true" data-name="Na2SO4">كبريتات الصوديوم Na₂SO₄</div>
<div class="chemical" draggable="true" data-name="KBr">بروميد البوتاسيوم KBr</div>
<div class="chemical" draggable="true" data-name="CO2">ثاني أكسيد الكربون CO₂</div>
<div class="chemical" draggable="true" data-name="KSCN">ثيوسيانات البوتاسيوم KSCN</div>
<div class="chemical" draggable="true" data-name="FeCl3">كلوريد الحديد FeCl₃</div>
<div class="chemical" draggable="true" data-name="Fe2O3">أكسيد الحديد Fe₂O₃</div>
<div class="chemical" draggable="true" data-name="Al">ألمنيوم Al</div>


      </div>

      <h3 class="section-title">اسحب المواد إلى أنبوب الاختبار</h3>
      <div id="test-tube" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)" ondrop="dropHandler(event)">
        <p id="tube-content">لا يوجد مواد بعد</p>
      </div>

      <div style="text-align: center;">
        <button onclick="runReaction()" style="padding: 0.8rem 1.5rem; font-size: 1rem;">
          <span>⚗️</span> تنفيذ التفاعل
        </button>
      </div>

      <div id="reaction-result"></div>
      <div id="quiz-section" class="hidden" style="margin-top: 1.5rem;">
  <h3 style="color: var(--primary-color);">🧠 سؤال سريع بعد التجربة</h3>
  <p id="quiz-question" style="font-weight: 600;"></p>
  <div id="quiz-options" style="margin-top: 1rem;"></div>
</div>

      <div id="score">نقاطك: 0</div>
    </section>

    <section class="history hidden" id="history-section">
      <h2 class="section-title">سجل التجارب</h2>
      <ul id="history-list"></ul>
    </section>
  

  </main>

<audio id="reaction-sound" src="https://www.dropbox.com/scl/fi/xz6xap9tsf45ivx0xrc8r/bubbling.mp3?rlkey=w8mvpu88dtf3v0xfqe84kv2q3&raw=1" preload="auto"></audio>

  <script>
    let selectedChemicals = [];
    let score = +localStorage.getItem("score") || 0;
    let history = JSON.parse(localStorage.getItem("history") || "[]");
    


    const scoreDisplay = document.getElementById('score');
    const resultDisplay = document.getElementById('reaction-result');
    const tubeContent = document.getElementById('tube-content');
    const tube = document.getElementById('test-tube');

   const reactionMap = {
  'HCl+NaOH': {
    title: '✅ تفاعل تعادل',
    equation: 'HCl + NaOH → NaCl + H₂O',
    description: 'يتكوّن ماء وملح عند مزج حمض الهيدروكلوريك مع هيدروكسيد الصوديوم.',
    colorEffect: '#a2d2ff'
  },
  'Na+H2O': {
    title: '⚠️ تفاعل عنيف',
    equation: '2Na + 2H₂O → 2NaOH + H₂↑',
    description: 'ينتج غاز الهيدروجين وتفاعل قوي قد يؤدي لانفجار بسيط.',
    colorEffect: '#ff6f61'
  },
  'HCl+Na': {
    title: '💥 تفاعل إزاحة',
    equation: '2Na + 2HCl → 2NaCl + H₂↑',
    description: 'الصوديوم يزيح الهيدروجين من الحمض ويتكوّن ملح وهيدروجين.',
    colorEffect: '#ffa69e'
  },
  'H2SO4+NaOH': {
    title: '✅ تعادل قوي',
    equation: 'H₂SO₄ + 2NaOH → Na₂SO₄ + 2H₂O',
    description: 'حمض الكبريتيك يكوّن كبريتات الصوديوم والماء.',
    colorEffect: '#a2d2ff'
  },
  'AgNO3+NaCl': {
    title: '⚗️ ترسيب أبيض',
    equation: 'AgNO₃ + NaCl → AgCl↓ + NaNO₃',
    description: 'يتكوّن راسب أبيض من كلوريد الفضة غير الذائب.',
    colorEffect: '#eeeeee'
  },
  'CuSO4+Fe': {
    title: '🔁 إحلال فلزي',
    equation: 'CuSO₄ + Fe → FeSO₄ + Cu↓',
    description: 'الحديد يزيح النحاس ويتكوّن كبريتات الحديد.',
    colorEffect: '#b5ead7'
  },
  'BaCl2+H2SO4': {
    title: '⚠️ ترسيب أبيض كثيف',
    equation: 'BaCl₂ + H₂SO₄ → BaSO₄↓ + 2HCl',
    description: 'تكوّن كبريتات الباريوم راسبًا أبيض كثيفًا غير ذائب.',
    colorEffect: '#f8f9fa'
  },
  'NH3+HCl': {
    title: '🔥 بخار أبيض',
    equation: 'NH₃ + HCl → NH₄Cl',
    description: 'ينتج بخار أبيض من كلوريد الأمونيوم عند التفاعل الغازي.',
    colorEffect: '#ffffff'
  },
  'Mg+O2': {
    title: '🔥 احتراق المعدن',
    equation: '2Mg + O₂ → 2MgO',
    description: 'ينتج ضوء وحرارة قوية عند احتراق المغنيسيوم في الأكسجين.',
    colorEffect: '#ffcf56'
  },
  'CaCO3+HCl': {
    title: '⚗️ تفاعل حمض-كربونات',
    equation: 'CaCO₃ + 2HCl → CaCl₂ + CO₂↑ + H₂O',
    description: 'ينتج غاز ثاني أكسيد الكربون وفقاعات واضحة.',
    colorEffect: '#d0f4de'
  },
  'Zn+H2SO4': {
    title: '💥 إحلال فلزي',
    equation: 'Zn + H₂SO₄ → ZnSO₄ + H₂↑',
    description: 'يتحرر غاز الهيدروجين وتصدر فقاعات.',
    colorEffect: '#ffaaa5'
  },
  'NaOH+FeSO4': {
    title: '🟢 ترسيب أخضر',
    equation: '2NaOH + FeSO₄ → Fe(OH)₂↓ + Na₂SO₄',
    description: 'يتكوّن راسب أخضر من هيدروكسيد الحديد الثنائي.',
    colorEffect: '#a3de83'
  },
  'CH4+O2': {
    title: '🔥 تفاعل احتراق',
    equation: 'CH₄ + 2O₂ → CO₂ + 2H₂O',
    description: 'احتراق الميثان في الأوكسجين ينتج طاقة وثاني أكسيد الكربون والماء.',
    colorEffect: '#ff9f1c'
  },
  'H2O2': {
    title: '🧪 تفاعل تفكك',
    equation: '2H₂O₂ → 2H₂O + O₂',
    description: 'يتفكك فوق أكسيد الهيدروجين إلى ماء وغاز الأوكسجين.',
    colorEffect: '#f3eac2'
  },
  'H2O': {
    title: '⚡ التحليل الكهربائي للماء',
    equation: '2H₂O → 2H₂ + O₂',
    description: 'عند تمرير تيار كهربائي، يتحلل الماء إلى غاز الهيدروجين والأوكسجين.',
    colorEffect: '#bde0fe'
  },
  'BaCl2+Na2SO4': {
    title: '⚗️ تفاعل ترسيب',
    equation: 'BaCl₂ + Na₂SO₄ → BaSO₄↓ + 2NaCl',
    description: 'ينتج راسب أبيض من كبريتات الباريوم.',
    colorEffect: '#f1f1f1'
  },
  'AgNO3+KBr': {
    title: '⚗️ ترسيب أصفر',
    equation: 'AgNO₃ + KBr → AgBr↓ + KNO₃',
    description: 'يتكوّن راسب أصفر من بروميد الفضة.',
    colorEffect: '#fff3b0'
  },
  'Zn+HCl': {
    title: '💥 تفاعل فلز مع حمض',
    equation: 'Zn + 2HCl → ZnCl₂ + H₂↑',
    description: 'ينتج غاز الهيدروجين وفقاعات.',
    colorEffect: '#f8ad9d'
  },
  'CO2+NaOH': {
    title: '🎯 تفاعل قاعدة مع أكسيد حمضي',
    equation: 'CO₂ + 2NaOH → Na₂CO₃ + H₂O',
    description: 'ينتج كربونات الصوديوم والماء.',
    colorEffect: '#d0e8f2'
  },
  'FeCl3+KSCN': {
    title: '🩸 تفاعل اللون الدموي',
    equation: 'FeCl₃ + 3KSCN → Fe(SCN)₃ + 3KCl',
    description: 'يتكوّن محلول أحمر دموي من ثيوسيانات الحديد.',
    colorEffect: '#d62828'
  },
  'Al+Fe2O3': {
    title: '🔥 تفاعل ثيرمايت',
    equation: '2Al + Fe₂O₃ → 2Fe + Al₂O₃',
    description: 'تفاعل حراري قوي ينتج الحديد المنصهر. (للعرض فقط)',
    colorEffect: '#e85d04'
  }
};


const quizMap = {
  'HCl+NaOH': {
    q: 'ما نوع التفاعل بين HCl و NaOH؟',
    options: ['احتراق', 'تعادل', 'إحلال'],
    answer: 'تعادل'
  },
  'Na+H2O': {
    q: 'ما الغاز الناتج من تفاعل الصوديوم مع الماء؟',
    options: ['أكسجين', 'هيدروجين', 'نيتروجين'],
    answer: 'هيدروجين'
  },
  'AgNO3+NaCl': {
    q: 'ما المادة التي تترسب عند خلط AgNO3 و NaCl؟',
    options: ['AgCl', 'NaNO3', 'NaCl'],
    answer: 'AgCl'
  },
  'CuSO4+Fe': {
    q: 'ما نوع هذا التفاعل؟',
    options: ['تعادل', 'إحلال', 'تحلل'],
    answer: 'إحلال'
  },
  'Al+Fe2O3': {
  q: 'ما المادة الناتجة الأساسية في تفاعل الثيرمايت؟',
  options: ['Al₂O₃', 'Fe₂O₃', 'FeCl₃'],
  answer: 'Fe'
}

};

    // تهيئة الصفحة
    document.addEventListener('DOMContentLoaded', () => {
      scoreDisplay.textContent = `نقاطك: ${score}`;
      
      document.querySelectorAll('.chemical').forEach(item => {
        item.addEventListener('dragstart', (e) => {
          e.dataTransfer.setData('text', item.dataset.name);
          item.style.opacity = '0.5';
        });
        
        item.addEventListener('dragend', (e) => {
          item.style.opacity = '1';
        });
      });
    });

    function dragOverHandler(e) {
      e.preventDefault();
      tube.classList.add('drag-over');
    }

    function dragLeaveHandler() {
      tube.classList.remove('drag-over');
    }

    function dropHandler(e) {
      e.preventDefault();
      tube.classList.remove('drag-over');
      
      const chemical = e.dataTransfer.getData('text');
      if (!selectedChemicals.includes(chemical)) {
        selectedChemicals.push(chemical);
        tubeContent.textContent = selectedChemicals.join(' + ');
        // showQuiz(key1) || showQuiz(key2);  // إظهار الكويز إن وُجد
      }
    }

  function runReaction() {
  if (selectedChemicals.length === 0) {
    resultDisplay.textContent = '⚠️ الرجاء إضافة مواد أولاً';
    return;
  }
  function showQuiz(reactionKey) {
  const quiz = quizMap[reactionKey];
  if (!quiz) return false;

  const section = document.getElementById('quiz-section');
  const question = document.getElementById('quiz-question');
  const optionsDiv = document.getElementById('quiz-options');

  section.classList.remove('hidden');
  question.textContent = quiz.q;
  optionsDiv.innerHTML = '';

  quiz.options.forEach(option => {
    const btn = document.createElement('button');
    btn.textContent = option;
    btn.style.margin = '0.5rem';
    btn.style.backgroundColor = '#fff';
    btn.style.color = '#333';
    btn.style.border = '2px solid var(--primary-color)';
    btn.style.padding = '0.5rem 1rem';
    btn.style.borderRadius = '8px';
    btn.style.cursor = 'pointer';
    btn.style.transition = 'var(--transition)';
    
    btn.onclick = () => {
      if (option === quiz.answer) {
showCustomAlert('✅ إجابة صحيحة! حصلت على +5 نقاط 🎖️', '#28a745');
        score += 5;
        localStorage.setItem("score", score);
        scoreDisplay.textContent = `نقاطك: ${score}`;
      } else {
showCustomAlert('❌ إجابة خاطئة. حاول مرة أخرى في التجربة القادمة.', '#dc3545');
      }
      section.classList.add('hidden');
    };

    optionsDiv.appendChild(btn);
  });

  return true;
}


  const sound = document.getElementById('reaction-sound');
  const key1 = selectedChemicals.join('+');
  const key2 = selectedChemicals.slice().reverse().join('+');
  const reaction = reactionMap[key1] || reactionMap[key2] || null;
document.getElementById("reaction-sound").play();

  if (reaction) {
    resultDisplay.innerHTML = `
      <strong>${reaction.title}</strong><br>
      ⚗️ <code>${reaction.equation}</code><br>
      <p>${reaction.description}</p>
    `;
    showQuiz(key1) || showQuiz(key2);


    score += 10;
    scoreDisplay.textContent = `نقاطك: ${score}`;
    localStorage.setItem("score", score);

    // تأثير الدخان
    const smoke = document.createElement('div');
    smoke.className = 'smoke';
    tube.appendChild(smoke);
    setTimeout(() => smoke.remove(), 2000);

    // تأثير لوني على أنبوب الاختبار
    if (reaction.colorEffect) {
      const originalBg = tube.style.backgroundColor;
      tube.style.backgroundColor = reaction.colorEffect;
      setTimeout(() => {
        tube.style.backgroundColor = originalBg || 'rgba(234, 250, 241, 0.5)';
      }, 2000);
    }

    // تشغيل الصوت
    sound.currentTime = 0;
    sound.play();

    // تسجيل في السجل
    const entry = `${new Date().toLocaleString('ar-EG')} - ${selectedChemicals.join(" + ")} → ${reaction.title}`;
    history.unshift(entry);
    if (history.length > 20) history.pop();
    localStorage.setItem("history", JSON.stringify(history));
  } else {
    resultDisplay.textContent = '❌ لا يوجد تفاعل ملحوظ بين هذه المواد';
    showQuiz(key1) || showQuiz(key2);

  }

  selectedChemicals = [];
  tubeContent.textContent = "لا يوجد مواد بعد";

  if (reaction.analysis) {
  const analysisBtn = document.createElement('button');
  analysisBtn.textContent = '🔍 حلّل التفاعل';
  analysisBtn.style.marginTop = '1rem';
  analysisBtn.onclick = () => showAnalysis(reaction.analysis);
  resultDisplay.appendChild(analysisBtn);
}

}


function showAnalysis(data) {
  const msg = `
    <strong>🔬 تحليل التفاعل:</strong><br>
    • نوع التفاعل: ${data.type}<br>
    • الطاقة: ${data.energy}<br>
    • النواتج: ${data.result}<br>
    • الملاحظات: ${data.observations}
  `;
  showCustomAlert(msg);
}


    function showHistory() {
      document.getElementById('lab-section').classList.add('hidden');
      document.getElementById('history-section').classList.remove('hidden');
      const list = document.getElementById('history-list');
      list.innerHTML = '';
      
      if (history.length === 0) {
        list.innerHTML = '<li style="text-align: center;">لا يوجد تجارب مسجلة بعد.</li>';
      } else {
        history.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          list.appendChild(li);
        });
      }
    }

    function showLab() {
      document.getElementById('lab-section').classList.remove('hidden');
      document.getElementById('history-section').classList.add('hidden');
    }

    function resetData() {
      if (confirm('هل أنت متأكد من إعادة ضبط النقاط وسجل التجارب؟ لن يمكنك استرجاع البيانات.')) {
        localStorage.clear();
        score = 0;
        history = [];
        scoreDisplay.textContent = 'نقاطك: 0';
        resultDisplay.textContent = '';
        showLab();
        
        // رسالة تأكيد
        const msg = document.createElement('div');
        msg.textContent = 'تمت إعادة الضبط بنجاح ✅';
        msg.style.position = 'fixed';
        msg.style.bottom = '20px';
        msg.style.left = '50%';
        msg.style.transform = 'translateX(-50%)';
        msg.style.backgroundColor = 'var(--primary-color)';
        msg.style.color = 'white';
        msg.style.padding = '0.8rem 1.5rem';
        msg.style.borderRadius = 'var(--border-radius)';
        msg.style.zIndex = '1000';
        msg.style.boxShadow = 'var(--box-shadow)';
        msg.style.fontSize = '0.9rem';
        document.body.appendChild(msg);
        
        setTimeout(() => msg.remove(), 3000);
      }
    }

const stepLab = {
  steps: [
    {
      instruction: "① أضف حمض الهيدروكلوريك HCl إلى أنبوب الاختبار.",
      image: "https://i.imgur.com/xcsfMiB.png"
    },
    {
      instruction: "② أضف فلز المغنيسيوم Mg وستلاحظ تصاعد الفقاعات.",
      image: "https://i.imgur.com/tVjkiwP.png"
    },
    {
      instruction: "③ يظهر غاز الهيدروجين ويتكون كلوريد المغنيسيوم.",
      image: "https://i.imgur.com/R0RZ2mw.png"
    }
  ],
  result: {
    title: "💥 تفاعل إزاحة",
    equation: "Mg + 2HCl → MgCl₂ + H₂↑",
    description: "يتحرر غاز الهيدروجين وفقاعات واضحة عند تفاعل المغنيسيوم مع الحمض."
  },
  currentStep: 0
};




function showStepLab(which = 'default') {
  document.getElementById('lab-section').classList.add('hidden');
  document.getElementById('history-section').classList.add('hidden');
  document.getElementById('step-lab-section').classList.remove('hidden');


  if (which === 'mg') currentStepLab = stepLab_Mg_O2;
  else if (which === 'caco3') currentStepLab = stepLab_CaCO3_HCl;
  else currentStepLab = stepLab;

  currentStepLab.currentStep = 0;
  showCurrentStep();
}



function showCurrentStep() {
  const s = currentStepLab.steps[currentStepLab.currentStep];
  document.getElementById('step-instructions').textContent = s.instruction;
  const img = document.getElementById('step-img');
  img.src = s.image;
  img.style.display = 'block';
  document.getElementById('step-result').innerHTML = '';
}

function nextStep() {
  currentStepLab.currentStep++;
  if (currentStepLab.currentStep >= currentStepLab.steps.length) {
    const r = currentStepLab.result;
    document.getElementById('step-instructions').textContent = '✅ التفاعل مكتمل!';
const img = document.getElementById('step-img');
img.style.display = 'none';
img.src = ''; // هذا السطر يمنع عرض صورة مكسورة
    document.getElementById('step-result').innerHTML = `
      <strong>${r.title}</strong><br>
      ⚗️ <code>${r.equation}</code><br>
      <p>${r.description}</p>
    `;
  } else {
    showCurrentStep();
  }
}


const stepLab_Mg_O2 = {
  steps: [
    {
      instruction: "① جهّز شريطًا من معدن الماغنيسيوم Mg.",
      image: "https://i.imgur.com/7BGa0ks.png"
    },
    {
      instruction: "② قرّب له مصدر نار أو شرارة قوية.",
      image: "https://i.imgur.com/tzGRmhk.png"
    },
    {
      instruction: "③ يبدأ الشريط بالاحتراق بسرعة وينتج وميض قوي.",
      image: "https://i.imgur.com/31y19CU.png"
    }
  ],
  result: {
    title: "🔥 تفاعل احتراق الماغنيسيوم",
    equation: "2Mg + O₂ → 2MgO",
    description: "ينتج أكسيد الماغنيسيوم على شكل مسحوق أبيض ويتحرر ضوء ساطع."
  },
  currentStep: 0
};



const stepLab_CaCO3_HCl = {
  steps: [
    {
      instruction: "① ضع بعض كربونات الكالسيوم CaCO₃ في أنبوب الاختبار.",
      image: "https://i.imgur.com/Jjk1ikY.png"
    },
    {
      instruction: "② أضف حمض الهيدروكلوريك HCl ببطء.",
      image: "https://i.imgur.com/k4oZoP4.png"
    },
    {
      instruction: "③ تظهر فقاعات غازية نتيجة التفاعل.",
      image: "https://i.imgur.com/USbJSW9.png"
    }
  ],
  result: {
    title: "💨 إنتاج غاز ثاني أكسيد الكربون",
    equation: "CaCO₃ + 2HCl → CaCl₂ + CO₂↑ + H₂O",
    description: "ينتج غاز CO₂ وفقاعات واضحة تدل على التفاعل."
  },
  currentStep: 0
};

    let currentStepLab = stepLab;



    function showCustomAlert(message, color = '#2c5e1a') {
  const alertBox = document.getElementById('custom-alert');
  alertBox.style.borderColor = color;
  alertBox.style.display = 'block';
  alertBox.innerHTML = message;

  setTimeout(() => {
    alertBox.style.display = 'none';
  }, 3000);
}

  </script>


<div id="custom-alert" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  color: #333;
  border: 3px solid var(--primary-color);
  padding: 1.5rem 2rem;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  font-size: 1.1rem;
  z-index: 9999;
  text-align: center;
  transition: all 0.4s ease;
  min-width: 250px;
  max-width: 80%;
"></div>

</body>
</html>